# AI Agent 应用系统

## 项目概述

本项目是一个基于 Modern.js 构建的 AI Agent 智能应用系统，集成了大语言模型能力、联网搜索功能和会话管理系统。系统采用前后端一体化架构，使用 BFF (Backend For Frontend) 模式提供统一的 API 接口服务。

## 技术栈

### 前端
- **框架**: React.js + Modern.js
- **样式**: Tailwind CSS
- **状态管理**: React Context API
- **构建工具**: Vite

### 后端 (BFF)
- **运行环境**: Node.js
- **API 架构**: BFF (Backend For Frontend)
- **数据库**: MongoDB
- **API 集成**: 豆包 AI API

### 开发工具
- **TypeScript**: 静态类型检查
- **Biome**: 代码质量工具
- **Tailwind CSS**: 样式框架

## 项目结构

```
├── api/                    # BFF API 实现
│   ├── lambda/             # API 路由处理器
│   │   └── chat/           # 聊天相关 API
│   │       └── index.ts    # 聊天 API 主入口
├── src/                    # 前端源代码
│   ├── components/         # React 组件
│   │   ├── Empty.tsx       # 空状态组件
│   │   └── ToolVisualizer.tsx  # 工具调用结果可视化
│   ├── contexts/           # React Context
│   │   └── authContext.ts  # 认证上下文
│   ├── hooks/              # 自定义 Hooks
│   │   └── useTheme.ts     # 主题切换 Hook
│   ├── lib/                # 工具库
│   │   ├── conversation.ts # 会话管理
│   │   ├── dbService.ts    # 数据库服务
│   │   ├── memoryManager.ts # 记忆管理
│   │   ├── todoVisualizer/ # TODO 列表可视化
│   │   │   ├── TodoListVisualizer.tsx # TODO 组件
│   │   │   ├── index.ts    # 导出
│   │   │   └── types.ts    # 类型定义
│   │   └── utils.ts        # 通用工具函数
│   ├── pages/              # 页面组件
│   │   └── Home.tsx        # 主页面
│   ├── App.tsx             # 应用入口组件
│   ├── index.css           # 全局样式
│   └── main.tsx            # 应用入口文件
├── modern.config.ts        # Modern.js 配置
├── package.json            # 项目依赖
├── tailwind.config.js      # Tailwind CSS 配置
└── tsconfig.json           # TypeScript 配置
```

## 主要功能

### 1. AI Agent 个性化设计与自主决策机制分析
- 支持用户自定义 AI Agent 名称、头像、个人介绍等
- 实现自己决策分别为分析，记忆，联网等
- 实现了记忆功能，能够根据用户输入和上下文进行个性化回复
- 支持设置偏好，如优先使用中文、英文等
- 分析用户行为模式，提供个性化建议

### 2. 联网搜索功能
- 集成了联网搜索能力
- 可以通过搜索增强 AI 回答的准确性
- 支持搜索结果的可视化展示

### 3. TODO 列表可视化
- 支持将 AI 生成的 TODO 列表转换为可视化组件
- 实现了点击复选框切换完成状态
- 已完成项自动移至末尾
- 支持键盘操作（空格键/回车键）
- 显示待办项数量统计
- 支持优先级标记

### 4. 主题切换
- 支持浅色/深色主题切换
- 主题状态持久化

### 5. 搜索功能
- 支持在对话历史中搜索关键词
- 高亮显示搜索结果
- 支持跳转到搜索结果位置


## 遇到的难点和解决过程

### 1. TODO 列表解析和可视化

**难点**：需要设计一种可靠的方式来识别和解析 AI 生成的 TODO 列表，并实现交互式可视化组件。

**解决过程**：
- 设计了标准的 JSON 格式来表示 TODO 列表数据
- 实现了类型守卫函数 `isTodoList` 和解析函数 `parseTodoList`，确保解析结果的正确性
- 设计了可扩展的类型定义，支持不同类型的 TODO 项和优先级
- 实现了交互式 UI，支持点击和键盘操作切换完成状态
- 实现了自动排序功能，将已完成项移至末尾，保持各自内部的原始顺序

### 2. 自动滚动功能

**难点**：在消息更新时，需要自动滚动到最新消息，但用户手动滚动时应停止自动滚动。

**解决过程**：
- 实现了滚动位置监听，检测用户是否手动滚动
- 使用 `useEffect` 钩子监听消息变化，在适当情况下触发自动滚动
- 提供了手动控制自动滚动的开关

### 3. 会话历史管理

**难点**：会话历史数据量大，需要高效加载和管理。

**解决过程**：
- 采用分页加载策略，只加载可见部分的消息
- 实现了会话预加载，提升切换对话时的响应速度
- 使用本地缓存存储会话历史，减少网络请求



## 个性化拓展内容

### 1. 主题切换增强

- 实现了平滑的主题过渡动画
- 支持根据系统主题自动切换
- 提供了多种主题配色方案

### 2. 对话导出功能

- 支持将对话历史导出为 Markdown 格式
- 支持导出为 JSON 格式，便于数据分析
- 导出功能支持选择导出范围（全部/当前对话）

### 3. 消息卡片设计

- 为不同类型的消息设计了不同的卡片样式
- 支持消息的复制、转发和引用功能
- 实现了消息的折叠/展开功能，便于查看长消息

### 4. 智能提示功能

- 实现了输入提示功能，根据历史对话内容推荐输入
- 支持快捷键操作，提升输入效率
- 提供了常用命令的快捷访问

## 快速开始

### 环境要求
- Node.js 16.x 或更高版本
- pnpm 包管理器
- MongoDB 数据库 (本地或远程)

### 安装步骤

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd ai-agent
   ```

2. **安装依赖**
   ```bash
   pnpm install
   ```

3. **配置环境变量**
   复制 `.env.example` 文件为 `.env` 并填写相关配置:
   ```
   # AI 模型配置
   DOUBAO_API_KEY=your_doubao_api_key
   
   # 数据库配置
   MONGODB_URI=mongodb://localhost:27017/ai-agent
   
   # 应用配置
   APP_PORT=3001
   ```

4. **启动开发服务器**
   ```bash
   pnpm run dev
   ```

5. **构建生产版本**
   ```bash
   pnpm run build
   ```

6. **运行生产版本**
   ```bash
   pnpm run start
   ```

## 未来规划

1. 用户系统：实现注册/登录功能，支持多用户使用
2. 多模型支持：支持切换不同的 AI 模型
3. 插件系统：实现插件机制，支持扩展功能
4. 完善记忆与偏好功能的数据库存储
5. 多语言支持：支持多语言界面和多语言对话
6. 性能优化：优化应用性能，提升响应速度


